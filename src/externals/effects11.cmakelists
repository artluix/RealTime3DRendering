cmake_minimum_required(VERSION 3.2 FATAL_ERROR)

project(effects11)

set(EFFECTS11_FILES
    # Binary
    Binary/EffectBinaryFormat.h
    Binary/EffectStateBase11.h
    Binary/EffectStates11.h
    Binary/SOParser.h

    # inc
    inc/d3dx11effect.h
    inc/d3dxGlobal.h

    # root folder
    d3dxGlobal.cpp
    Effect.h
    EffectAPI.cpp
    EffectLoad.h
    EffectLoad.cpp
    EffectNonRuntime.cpp
    EffectReflection.cpp
    EffectRuntime.cpp
    EffectVariable.inl
    IUnknownImp.h
    pchfx.h
)

# PTODO: Add headers here
add_library(effects11 OBJECT
    ${EFFECTS11_FILES}
)

target_include_directories(effects11
    PUBLIC
        $<BUILD_INTERFACE:${CMAKE_CURRENT_SOURCE_DIR}/inc>
    PRIVATE
        Binary
        inc
)

target_compile_options(effects11
    PRIVATE
        /W4
        /fp:fast
        /arch:SSE2
        /EHsc
        /openmp-
        /Yupchfx.h
        # debug
        $<$<CONFIG:DEBUG>:/Od /MDd /ZI /RTC1>
        # release
        $<$<CONFIG:RELEASE>:/O2 /MD /Gy /Oi>
)

target_compile_definitions(effects11
    PUBLIC
        -DUNICODE
        -D_UNICODE
        -DD3DXFX_LARGEADDRESS_HANDLE
        -D_WIN32_WINNT=0x0600
        -D_WIN7_PLATFORM_UPDATE
        -DWIN32
)

set_source_files_properties(d3dxGlobal.cpp PROPERTIES COMPILE_FLAGS /Ycpchfx.h)

# ide filters
source_group(TREE ${CMAKE_CURRENT_SOURCE_DIR} FILES ${EFFECTS11_FILES})